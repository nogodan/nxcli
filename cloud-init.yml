#cloud-config
repo_update: true
repo_upgrade: all

package_upgrade: true
hostname: nutanix
fqdn: nutanix.example.com
users:
  - name: nutanix
    groups: sudo
    shell: /bin/bash
    sudo: ['ALL=(ALL) NOPASSWD:ALL']
    ssh-authorized-keys:
      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCnWNa4I9QT8PkiuYtPmNNdtGmR6pYnLQgZ6tEG9+FzPBrNmn59leATGaFwis1/Up8qyqClSdSxJY10bNiAx8fLdK5x5T42I7h3JEwHo72wQx4tazeNRfeU9zrAuokKNMVklC6H2RUDryJ6BLWG/MPiNvtiLhg8oPSYeJk4RPhZPQQWU2p0NysUJyu8fgsGms/vq6r2fLLQxgXMtYv+AvrKnXL2jYO2oqb/KJOfY8DZeqdJPU6ZZVQ7IURT/1J00GNUNkVwTmbgEw7MCebDrFdsO2z9VwMl/YXJHDXlkI2/e3zTBElJBrlrtwMRyy9CZMyN5LHommNPmEJ0ydj2R/uL taeho@Taehos-MacBook-Pro.local
runcmd:
  - sed -i -e '/^PermitRootLogin/s/^.*$/PermitRootLogin no/' /etc/ssh/sshd_config
  - sed -i 's|[#]*PasswordAuthentication yes|PasswordAuthentication no|g' /etc/ssh/sshd_config
  - sed -i 's|UsePAM yes|UsePAM no|g' /etc/ssh/sshd_config
  - restart ssh
final_message: "The system is finally up, after $UPTIME seconds"
# CentOS on Digital Ocean not working for some reason but Ubuntu 14.04 does
# cloud-init logs: /var/log/cloud-init.log and /var/log/cloud-init-output.log
# References:
# - https://https://gist.github.com/dikaio/
# - https://cloudinit.readthedocs.io/en/latest/
# - https://help.ubuntu.com/community/CloudInit
# - https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux_OpenStack_Platform/4/html/End_User_Guide/user-data.html
# - https://bazaar.launchpad.net/~cloud-init-dev/cloud-init/trunk/files/head:/doc/examples/
packages:
  - httpd
  - iperf
  - ansible
